# Тестовое задание на позицию стажера Avito
___
В этом репозитории находится реализация [тестового задания](https://github.com/avito-tech/backend-trainee-assignment-2023) на позицию стажёра-бэкендера в Avito.

###### Выполнено ######
+ Основное задание
+ Доп. задание №1
+ Доп. задание №2
+ Доп. задание №3
+ Написаны тесты
+ Человеко-читабельные описания ошибок API
+ Документация Swagger
+ Докеризация

### Запуск
___

Для запуска требуется выполнить следующие шаги:

1. Скачать исходный код и перейти в директорию с проектом:
```linux
git clone https://github.com/pollykon/avito_test_task.git
cd avito_test_task
```
2. Настроить переменные окружения. В корне проекта нужно создать .env файл следующего содержания:
```text
PG_HOST = <хост_который_будет_использовать_бд>
PG_PORT = <порт_который_будет_использовать_бд>
PG_USER = <имя_пользователя_которое_будет_использовать_бд>
PG_PASSWORD = <пароль_который_будет_использовать_бд>
PG_DATABASE_NAME = <имя_бд>

LOGS_CSV_DIRECTORY = <директория_в_которой_будут_храниться_сгенерированные_логи>
```
3. Создать папку для логов:
```text
mkdir <директория_в_которой_будут_храниться_сгенерированные_логи>
```
4. Для развертывания dev-среды:
    + Запустить контейнер с базой данных
   ```text
    docker-compose up
    ```
   + Запустить сервер
   ```
   go run ./cmd/main/
   ```
5. Для развертывания prod-среды:
    + Запустить контейнеры с базой данных и сервером
   ```
   docker-compose -f docker-compose.prod.yml up --build 
   ```
6. Создать таблицы в базе данных. SQL файл с созданием необходимых таблиц находится [тут](https://github.com/pollykon/avito_test_task/blob/main/migration.sql) 

### Детали реализации
___
Микросервис написан на Go, СУБД - PostgreSQL. Все запросы/ответы принимаются/отдаются в формате JSON.

#### Доп. задание №1
В базе данных помимо таблиц сегментов, пользователя и их связующей существует независимая таблица с логами,
в которой хранится история удаления/добавления пользователя. При добавлении пользователя в сегмент
в таблицу с логами также записывается информация об операции. При запросе на получение логов 
из таблицы достаётся информация о пользователе за определенный период. Далее в сервисе генерируется строка
в формате csv и добавляется в файл в папку log_csv. В ответе JSON в поле "url" пользователю предоставляется
url, при запросе по которому 
#### Доп. задание №2
#### Доп. задание №3

### Вопросы по ТЗ и их решения
___
#### Разделение ручек на удаление и добавление пользователя 
В задании для добавления и удаления пользователя предлагалось обращаться к одной ручке. Однако мне такое решение 
показалось недобным, поскольку одна ручка будет отвечать за большой слой логики. Поэтому

### Структура проекта
___
```
avito_test_task/     
├─ cmd/
│  ├─ service/
│  │  ├─ main.go
├─ internal/   
│  ├─ handlers/      слой сетевого взаимодействия
│  ├─ logger/        
│  ├─ repository/    слой взаимодействия с данными
│  ├─ service/       слой бизнес-логики
├─ logs_csv/         хранение логов
```